<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
	<sub-flow name="client-db-wms-get-availability" doc:id="8cf9afc6-58b3-49d5-9ae7-8f8d694bb829" >
		<db:select doc:name="Select" doc:id="efda0571-bb4f-4dc0-becb-413ac6981664" config-ref="Database_Config_WMS_BlueYonder">
			<db:sql ><![CDATA[#[vars.queryAvailability]]]></db:sql>
		</db:select>
	</sub-flow>
	<sub-flow name="client-db-wms-get-volumetry" doc:id="668624cb-11e6-4fec-82c9-18369b7a2669" >
		<db:select doc:name="Select" doc:id="529895af-3d19-4897-b0bc-6f2a588a1af7" config-ref="Database_Config_WMS_BlueYonder">
			<db:sql ><![CDATA[#[vars.queryVolumetry]]]></db:sql>
		</db:select>
	</sub-flow>
	<sub-flow name="client-db-wms-get-partfoot-details" doc:id="c504be1d-524e-4928-a87a-9dcb543e8e4b" >
		<db:select doc:name="Select" doc:id="a2d5ad18-aaf6-40ec-b465-db5324a006a9" config-ref="Database_Config_WMS_BlueYonder">
			<db:sql ><![CDATA[select shipment.ship_id,
        prtmst.prtnum,
        trlr.dispatch_dte fecha_despacho,
        ord.stcust umu_idestacion,
        stop.stop_id tipoestacion_parada,
        adrmst.adrln1 calle,
        (select lngdsc
         from TRXWMSPRD.dscmst
         where colnam = 'adrstc'
			AND locale_id = 'ES-ES'
            AND colval = 'MEX|' || adrmst.adrstc) estado,
        adrmst.ctry_name pais,
        (select sum(aiv_2.untqty)
         from TRXWMSPRD.all_inventory_view aiv_2
         where aiv_2.subnum = all_inventory_view.subnum) total_mercancias,
        (select lngdsc
         from TRXWMSPRD.dscmst
         where colnam = 'ctncod|wh_id'
			and locale_id = 'ES-ES'
            and colval = pckwrk_view.ctncod || '|' || ord.wh_id) unidad_peso,
        altprt_sat.alt_prtnum clavesat,
        prtdsc.lngdsc descripcion,
        all_inventory_view.untqty cantidades,
        decode(prtmst.hazmat_flg, 0, 'NO', 'SI') peligroso,
        prtmst.ltlcls clave_peligroso,
        prtftp_dtl.grswgt * all_inventory_view.untqty pesoxarticulo,
        adrmst_car.adr_district permiso_transporte,
        trlr.trlr_seal2 aseguradora,
        trlr.trlr_seal3 poliza,
        trlr.trlr_typ tipo_vehiculo,
        trlr.trlr_ref placa,
        trlr.trlr_seal4 modelo,
        powerunit.powerunit_type tipo_remolque,
        powerunit.powerunit_id placa_remolque,
        trlr.trlr_broker rfc_operador,
        trlr.driver_nam nombre_operador,
        trlr.driver_lic_num lic_operador,
        carhdr.accnum rfc_transp,
        carhdr.carnam nombre_transp,
        adrmst_car.adrln1 calle_transp,
        adrmst_car.adrstc estado_transp,
        adrmst_car.adrcty pais_transp,
        adrmst_car.adrpsz cp_transp,
        ord.entdte fecha_levantamiento,
        prtmst.comcod partida_presupuestal,
		shipment_line.pckgr1 monto
from TRXWMSPRD.ord
	join TRXWMSPRD.ord_line
    on ord.ordnum = ord_line.ordnum
		and ord.wh_id = ord_line.wh_id
		and ord.client_id = ord_line.client_id
	join TRXWMSPRD.adrmst
	on adrmst.client_id = ord.client_id
		and adrmst.host_ext_id = ord.stcust
		and adrmst.adrtyp = 'CST'
    join TRXWMSPRD.shipment_line
    on shipment_line.ordnum = ord_line.ordnum
		and shipment_line.ordlin = ord_line.ordlin
		and shipment_line.wh_id = ord_line.wh_id
		and shipment_line.client_id = ord_line.client_id
		and shipment_line.linsts <> 'B'
    join TRXWMSPRD.all_inventory_view
    on all_inventory_view.wh_id = shipment_line.wh_id
		and all_inventory_view.prt_client_id = shipment_line.prt_client_id
		and all_inventory_view.ship_line_id = shipment_line.ship_line_id
	left join TRXWMSPRD.prtmst
	on all_inventory_view.prtnum = prtmst.prtnum
		and all_inventory_view.prt_client_id = prtmst.prt_client_id
		and prtmst.wh_id_tmpl = 'AVIOR-27'
	left join TRXWMSPRD.prtdsc
	on prtdsc.colnam = 'prtnum|prt_client_id|wh_id_tmpl'
		and prtdsc.colval = all_inventory_view.prtnum || '|' || all_inventory_view.prt_client_id || '|' || all_inventory_view.wh_id
	left join TRXWMSPRD.alt_prtmst altprt_sat
	on all_inventory_view.prtnum = altprt_sat.prtnum
		and all_inventory_view.prt_client_id = altprt_sat.prt_client_id
		and altprt_sat.alt_prt_typ = 'SAT'
        /* Huella pieza */
	left join TRXWMSPRD.prtftp_dtl
	on all_inventory_view.wh_id = prtftp_dtl.wh_id
		and all_inventory_view.prtnum = prtftp_dtl.prtnum
		and all_inventory_view.ftpcod = prtftp_dtl.ftpcod
		and prtftp_dtl.uomlvl = 0
	join TRXWMSPRD.shipment
	on shipment.ship_id = shipment_line.ship_id
		and shipment.wh_id = shipment_line.wh_id
		and shipment.shpsts <> 'B'
	join TRXWMSPRD.stop
    on shipment.stop_id = stop.stop_id
	join TRXWMSPRD.car_move
    on stop.car_move_id = car_move.car_move_id
	join TRXWMSPRD.trlr
    on car_move.trlr_id = trlr.trlr_id
		and trlr.trlr_cod = 'SHIP'
	left join TRXWMSPRD.pckwrk_view
	on pckwrk_view.client_id = shipment_line.client_id
		and pckwrk_view.wh_id = shipment_line.wh_id
		and pckwrk_view.ship_id = shipment_line.ship_id
		and pckwrk_view.ordnum = shipment_line.ordnum
		and pckwrk_view.prtnum = 'KITPART'
	left join TRXWMSPRD.carhdr
	on car_move.carcod = carhdr.carcod
	left join TRXWMSPRD.adrmst adrmst_car
    on carhdr.adr_id = adrmst_car.adr_id
	left join TRXWMSPRD.powerunit
	on car_move.carcod = powerunit.carcod
	AND trlr.powerunit_id = powerunit.powerunit_id
where ord.wh_id = 'AVIOR-27'
	and all_inventory_view.stoloc = trlr.trlr_id
	AND shipment.ship_id = :shipment
group by ord.ordnum,
        prtmst.prtnum,
        shipment.ship_id,
        trlr.dispatch_dte,
        ord.stcust,
        stop.stop_id,
        adrmst.adrln1,
        adrmst.adrstc,
        adrmst.ctry_name,
        pckwrk_view.ctncod,
        ord.wh_id,
        altprt_sat.alt_prtnum,
        all_inventory_view.untqty,
        all_inventory_view.subnum,
        prtdsc.lngdsc,
        prtmst.hazmat_flg,
        prtmst.ltlcls,
        prtftp_dtl.grswgt,
        adrmst_car.adr_district,
        trlr.trlr_seal2,
        trlr.trlr_seal3,
        trlr.trlr_seal4,
        trlr.trlr_typ,
        trlr.trlr_ref,
        powerunit.powerunit_type,
        powerunit.powerunit_id,
        trlr.trlr_broker,
        trlr.driver_lic_num,
        trlr.driver_nam,
        carhdr.accnum,
        carhdr.carnam,
        adrmst_car.adrln1,
        adrmst_car.adrcty,
        adrmst_car.adrstc,
        adrmst_car.adrpsz,
        prtmst.comcod,
        ord.entdte,
        shipment_line.pckgr1]]></db:sql>
			<db:input-parameters ><![CDATA[#[shipment:payload]]]></db:input-parameters>
		</db:select>
	</sub-flow>
	<sub-flow name="client-db-wms-get-box-quantity" doc:id="0c31bbcd-70e6-4f4a-8546-188b92a19c4a" >
		<db:select doc:name="Select" doc:id="99247b82-ec6d-40d6-9f8d-c8134d005366" config-ref="Database_Config_WMS_BlueYonder">
			<db:sql ><![CDATA[#[vars.queryBoxQuantity]]]></db:sql>
			<db:input-parameters ><![CDATA[#[shipment:payload]]]></db:input-parameters>
		</db:select>
	</sub-flow>
	<sub-flow name="client-db-wms-get-logistics-footprint" doc:id="1dea7a51-4674-4ad4-8e38-ff198bf66e3b" >
		<db:select doc:name="Select" doc:id="4754006c-1203-46c8-8718-c781618ad286" config-ref="Database_Config_WMS_BlueYonder">
			<db:sql ><![CDATA[#[vars.queryLogisticFootprint]]]></db:sql>
		</db:select>
	</sub-flow>
	<sub-flow name="client-db-wms-get-box" doc:id="0c31bbcd-70e6-4f4a-8546-188b92a19c4a" >
		<db:select doc:name="Select" doc:id="f795c9d5-854c-424f-9313-820d5f45f012" config-ref="Database_Config_WMS_BlueYonder" >
			<db:sql ><![CDATA[select *
from
(select count(distinct pv2.ctnnum) as "SurtidosEnPalet", 
        max(iv.lodnum) LPN
from TRXWMSPRD.pckwrk_view pv1
join TRXWMSPRD.pckwrk_view pv2
on pv1.schbat = pv2.schbat
        and pv1.ordnum = pv2.ordnum
        and pv1.ordlin = pv2.ordlin
        and pv1.ordsln = pv2.ordsln
        and pv1.subnum = pv2.ctnnum
join TRXWMSPRD.inventory_view iv
on pv2.wrkref = iv.wrkref
        and pv2.wrkref_dtl = iv.wrkref_dtl
        and pv2.ship_line_id = iv.ship_line_id
        and pv2.ctnnum = iv.subnum
        and pv2.wh_id = iv.wh_id
        and pv2.prt_client_id = iv.prt_client_id
        and pv2.prtnum = iv.prtnum
JOIN TRXWMSPRD.locmst lm
on iv.wh_id = lm.wh_id
        and iv.stoloc = lm.stoloc
where pv1.ordnum = :ordnum
        and pv1.wrktyp = 'K'
        and pv1.appqty = 1
        and lm.mov_zone_id in ('10093', '10036')) inPal,
(select count(distinct pv2.ctnnum) as "Surtidos"
from TRXWMSPRD.pckwrk_view pv1
join TRXWMSPRD.pckwrk_view pv2
on pv1.schbat = pv2.schbat
        and pv1.ordnum = pv2.ordnum
        and pv1.ordlin = pv2.ordlin
        and pv1.ordsln = pv2.ordsln
        and pv1.subnum = pv2.ctnnum
join TRXWMSPRD.inventory_view iv
on pv2.wrkref = iv.wrkref
        and pv2.wrkref_dtl = iv.wrkref_dtl
        and pv2.ship_line_id = iv.ship_line_id
        and pv2.ctnnum = iv.subnum
        and pv2.wh_id = iv.wh_id
        and pv2.prt_client_id = iv.prt_client_id
        and pv2.prtnum = iv.prtnum
JOIN TRXWMSPRD.locmst lm
on iv.wh_id = lm.wh_id
        and iv.stoloc = lm.stoloc
where pv1.ordnum = :ordnum
        and pv1.wrktyp = 'K'
        and pv1.appqty = 1
        and lm.mov_zone_id not in ('10093', '10036')) inPal2,
(select count(*) "SinSurtir"
   from TRXWMSPRD.pckwrk_view
  where ordnum = :ordnum
    and wrktyp = 'K'
    and appqty = 0) "Mis"]]></db:sql>
			<db:input-parameters ><![CDATA[#[ordnum: payload]]]></db:input-parameters>
		</db:select>
	</sub-flow>
	<sub-flow name="client-db-wms-get-lpn" doc:id="5aeb1db0-6d8d-472e-ad4a-678eca027890" >
		<db:select doc:name="Select" doc:id="b95dd3ad-9484-442b-80d8-c93b9575a296" config-ref="Database_Config_WMS_BlueYonder" >
			<db:sql ><![CDATA[select * from
(select count(distinct pv2.ctnnum) "SurtidosEnPalet"
   from TRXWMSPRD.pckwrk_view pv1
   join TRXWMSPRD.pckwrk_view pv2
     on pv1.schbat = pv2.schbat
    and pv1.ordnum = pv2.ordnum
    and pv1.ordlin = pv2.ordlin
    and pv1.ordsln = pv2.ordsln
    and pv1.subnum = pv2.ctnnum
   join TRXWMSPRD.inventory_view iv
     on pv2.wrkref = iv.wrkref
    and pv2.wrkref_dtl = iv.wrkref_dtl
    and pv2.ship_line_id = iv.ship_line_id
    and pv2.ctnnum = iv.subnum
    and pv2.wh_id = iv.wh_id
    and pv2.prt_client_id = iv.prt_client_id
    and pv2.prtnum = iv.prtnum
   JOIN TRXWMSPRD.locmst lm
     on iv.wh_id = lm.wh_id
    and iv.stoloc = lm.stoloc
  where IV.lodnum = :lodnum
    and pv1.wrktyp = 'K'
    and pv1.appqty = 1
    and lm.mov_zone_id in ('10093','10036')) a,
(select count(*) SinSurtir
   from TRXWMSPRD.pckwrk_view pv
   join TRXWMSPRD.inventory_pckwrk_view ipv
     on pv.ordnum = ipv.ordnum
    and ipv.lodnum != pv.lodnum
  where pv.wrktyp = 'K'
    and pv.appqty = 0
    and ipv.lodnum = :lodnum) b,
(select count(distinct ipv2.ctnnum) Surtidos
   from TRXWMSPRD.inventory_pckwrk_view ipv2
   join TRXWMSPRD.locmst
     on ipv2.stoloc = locmst.stoloc
    and ipv2.wh_id = locmst.wh_id
    and locmst.mov_zone_id not in ('10093', '10036')
        /*and ipv.lodnum != ipv2.lodnum*/
  where ipv2.ordnum in (select distinct ordnum
                          from TRXWMSPRD.inventory_pckwrk_view ipv3
                         where lodnum = :lodnum)
    and ipv2.subnum like 'CTN%') c]]></db:sql>
			<db:input-parameters ><![CDATA[#[lodnum: payload]]]></db:input-parameters>
		</db:select>
	</sub-flow>
	<sub-flow name="client-db-wms-get-lpn-full" doc:id="e880c21b-d96b-496f-9ac9-f12987aadf03" >
		<db:select doc:name="Select" doc:id="125e980b-8bda-40a3-bcf4-df2aefa7a174" config-ref="Database_Config_WMS_BlueYonder" >
			<db:sql ><![CDATA[select *
from
(select /*distinct ordnum*/ listagg (distinct ordnum,',') as ordnum
  from TRXWMSPRD.inventory_pckwrk_view ipv3
 where lodnum = :lodnum
   and ipv3.subnum like 'CTN%') delivery,
(select count(distinct pv2.ctnnum) as "delvSurtidosEnPalet"
from TRXWMSPRD.pckwrk_view pv1
join TRXWMSPRD.pckwrk_view pv2
on pv1.schbat = pv2.schbat
        and pv1.ordnum = pv2.ordnum
        and pv1.ordlin = pv2.ordlin
        and pv1.ordsln = pv2.ordsln
        and pv1.subnum = pv2.ctnnum
join TRXWMSPRD.inventory_view iv
on pv2.wrkref = iv.wrkref
        and pv2.wrkref_dtl = iv.wrkref_dtl
        and pv2.ship_line_id = iv.ship_line_id
        and pv2.ctnnum = iv.subnum
        and pv2.wh_id = iv.wh_id
        and pv2.prt_client_id = iv.prt_client_id
        and pv2.prtnum = iv.prtnum
JOIN TRXWMSPRD.locmst lm
on iv.wh_id = lm.wh_id
        and iv.stoloc = lm.stoloc
where pv1.ordnum in (select distinct ordnum
                      from TRXWMSPRD.inventory_pckwrk_view ipv3
                     where lodnum = :lodnum
                       and ipv3.subnum like 'CTN%')
        and pv1.wrktyp = 'K'
        and pv1.appqty = 1
        and lm.mov_zone_id in ('10093', '10036')) inPal,
(select count(distinct pv2.ctnnum) as "delvSurtidos"
from TRXWMSPRD.pckwrk_view pv1
join TRXWMSPRD.pckwrk_view pv2
on pv1.schbat = pv2.schbat
        and pv1.ordnum = pv2.ordnum
        and pv1.ordlin = pv2.ordlin
        and pv1.ordsln = pv2.ordsln
        and pv1.subnum = pv2.ctnnum
join TRXWMSPRD.inventory_view iv
on pv2.wrkref = iv.wrkref
        and pv2.wrkref_dtl = iv.wrkref_dtl
        and pv2.ship_line_id = iv.ship_line_id
        and pv2.ctnnum = iv.subnum
        and pv2.wh_id = iv.wh_id
        and pv2.prt_client_id = iv.prt_client_id
        and pv2.prtnum = iv.prtnum
JOIN TRXWMSPRD.locmst lm
on iv.wh_id = lm.wh_id
        and iv.stoloc = lm.stoloc
where pv1.ordnum in (select distinct ordnum
                      from TRXWMSPRD.inventory_pckwrk_view ipv3
                     where lodnum = :lodnum
                       and ipv3.subnum like 'CTN%')
        and pv1.wrktyp = 'K'
        and pv1.appqty = 1
        and lm.mov_zone_id not in ('10093', '10036')) inPal2,
(select count(*) "delvSinSurtir"
   from TRXWMSPRD.pckwrk_view
  where ordnum in (select distinct ordnum
                    from TRXWMSPRD.inventory_pckwrk_view ipv3
                   where lodnum = :lodnum
                     and ipv3.subnum like 'CTN%')
    and wrktyp = 'K'
    and appqty = 0) "Mis",
(select count(distinct pv2.ctnnum) "lpnSurtidosEnPalet"
   from TRXWMSPRD.pckwrk_view pv1
   join TRXWMSPRD.pckwrk_view pv2
     on pv1.schbat = pv2.schbat
    and pv1.ordnum = pv2.ordnum
    and pv1.ordlin = pv2.ordlin
    and pv1.ordsln = pv2.ordsln
    and pv1.subnum = pv2.ctnnum
   join TRXWMSPRD.inventory_view iv
     on pv2.wrkref = iv.wrkref
    and pv2.wrkref_dtl = iv.wrkref_dtl
    and pv2.ship_line_id = iv.ship_line_id
    and pv2.ctnnum = iv.subnum
    and pv2.wh_id = iv.wh_id
    and pv2.prt_client_id = iv.prt_client_id
    and pv2.prtnum = iv.prtnum
   JOIN TRXWMSPRD.locmst lm
     on iv.wh_id = lm.wh_id
    and iv.stoloc = lm.stoloc
  where IV.lodnum = :lodnum
    and pv1.wrktyp = 'K'
    and pv1.appqty = 1
    and lm.mov_zone_id in ('10093','10036')) a,
(select count(*) "lpnSinSurtir"
   from TRXWMSPRD.pckwrk_view pv
   join TRXWMSPRD.inventory_pckwrk_view ipv
     on pv.ordnum = ipv.ordnum
    and ipv.lodnum != pv.lodnum
  where pv.wrktyp = 'K'
    and pv.appqty = 0
    and ipv.lodnum = :lodnum) b,
(select count(distinct ipv2.ctnnum) "lpnSurtidos"
   from TRXWMSPRD.inventory_pckwrk_view ipv2
   join TRXWMSPRD.locmst
     on ipv2.stoloc = locmst.stoloc
    and ipv2.wh_id = locmst.wh_id
    and locmst.mov_zone_id not in ('10093', '10036')
        /*and ipv.lodnum != ipv2.lodnum*/
  where ipv2.ordnum in (select distinct ordnum
                          from TRXWMSPRD.inventory_pckwrk_view ipv3
                         where lodnum = :lodnum)
    and ipv2.subnum like 'CTN%')]]></db:sql>
			<db:input-parameters ><![CDATA[#[lodnum: payload]]]></db:input-parameters>
		</db:select>
	</sub-flow>
	<sub-flow name="client-db-wms-cajas-carton-order" doc:id="fc8f171d-0403-4681-ad80-5949e75971de" >
		<db:select doc:name="Select" doc:id="7ff12290-20a1-41fe-b693-5a795404c521" config-ref="Database_Config_WMS_BlueYonder">
			<db:sql ><![CDATA[select (select distinct cr.car_move_id /*Obtener order num por medio del lpn*/
          from TRXWMSPRD.all_inventory_view aiv
          join TRXWMSPRD.shipment_line sl
            on aiv.ship_line_id = sl.ship_line_id
          join TRXWMSPRD.shipment sh
            on sh.ship_id = sl.ship_id
          join TRXWMSPRD.stop st
            on st.stop_id = sh.stop_id
          join TRXWMSPRD.car_move cr
            on cr.car_move_id = st.car_move_id
         where lodnum = :lodnum
           and rownum = 1) carga,
       (select count(distinct all_inventory_view.subnum) /*obtener cajas fisicas en sitio 10038*/
          from TRXWMSPRD.car_move
          join TRXWMSPRD.stop
            on stop.car_move_id = car_move.car_move_id
          join TRXWMSPRD.shipment
            on shipment.stop_id = stop.stop_id
          join TRXWMSPRD.shipment_line
            on shipment_line.ship_id = shipment.ship_id
          left
          join TRXWMSPRD.all_inventory_view
            on all_inventory_view.ship_line_id = shipment_line.ship_line_id
           and all_inventory_view.wh_id = shipment_line.wh_id
           and all_inventory_view.wh_id = shipment.wh_id
          join TRXWMSPRD.prtmst
            on all_inventory_view.prtnum = prtmst.prtnum
           and all_inventory_view.prt_client_id = prtmst.prt_client_id
           and all_inventory_view.wh_id = prtmst.wh_id_tmpl
          join TRXWMSPRD.prtfam
            on prtfam.prtfam = prtmst.prtfam
          join TRXWMSPRD.prtfam_grp
            on prtfam_grp.prtfamgrp = prtfam.prtfamgrp
          left
          join TRXWMSPRD.prtdsc
            on prtdsc.colnam = /*#nobind*/ 'prtnum|prt_client_id|wh_id_tmpl' /*#bind*/
           and prtdsc.colval = prtmst.prtnum || '|' || prtmst.prt_client_id || '|' || prtmst.wh_id_tmpl
           and prtdsc.locale_id = /*#nobind*/ 'ES-ES' /*#bind*/
          join TRXWMSPRD.dscmst prtfamgrp_dsc
            on prtfamgrp_dsc.colnam = /*#nobind*/ 'prtfamgrp' /*#bind*/
           and prtfamgrp_dsc.colval = prtfam_grp.prtfamgrp
           and prtfamgrp_dsc.locale_id = 'ES-ES'
          join TRXWMSPRD.locmst
            on locmst.stoloc = all_inventory_view.stoloc
           and locmst.mov_zone_id = '10038'
         where all_inventory_view.wh_id = :wh_id
           and car_move.car_move_id = (select distinct cr.car_move_id
                                         from TRXWMSPRD.all_inventory_view aiv
                                         join TRXWMSPRD.shipment_line sl
                                           on aiv.ship_line_id = sl.ship_line_id
                                         join TRXWMSPRD.shipment sh
                                           on sh.ship_id = sl.ship_id
                                         join TRXWMSPRD.stop st
                                           on st.stop_id = sh.stop_id
                                         join TRXWMSPRD.car_move cr
                                           on cr.car_move_id = st.car_move_id
                                        where lodnum = :lodnum)
           and (all_inventory_view.phyflg = 1)) +
        
       (select nvl(sum(sumas.suma),0) /*obtener cajas no fisicas en sitio 10038*/
          from (select ceil((select sum(lod1.untqty / lod1.untcas)
                               from TRXWMSPRD.all_inventory_view lod1
                              where lod1.subnum = all_inventory_view.subnum)) as suma,
                       prtfam.prtfamgrp
                  from TRXWMSPRD.ord
                  join TRXWMSPRD.shipment_line shipment_line1
                    on shipment_line1.ordnum = ord.ordnum
                   and shipment_line1.client_id = ord.client_id
                   and shipment_line1.wh_id = ord.wh_id
                  join TRXWMSPRD.shipment
                    on shipment.ship_id = shipment_line1.ship_id
                   and shipment.wh_id = shipment_line1.wh_id
                  join TRXWMSPRD.all_inventory_view
                    on all_inventory_view.ship_line_id = shipment_line1.ship_line_id
                   and all_inventory_view.wh_id = shipment_line1.wh_id
                   and all_inventory_view.prtnum = shipment_line1.prtnum
                   and all_inventory_view.prt_client_id = shipment_line1.prt_client_id
                  join TRXWMSPRD.stop stop_2
                    on stop_2.stop_id = shipment.stop_id
                  join TRXWMSPRD.car_move car_move2
                    on car_move2.car_move_id = stop_2.car_move_id
                  left
                  join TRXWMSPRD.trlr
                    on trlr.trlr_id = car_move2.trlr_id
                  join TRXWMSPRD.cstmst
                    on cstmst.cstnum = ord.stcust
                  join TRXWMSPRD.adrmst
                    on adrmst.adr_id = cstmst.adr_id
                  join TRXWMSPRD.prtmst prt1
                    on prt1.prtnum = all_inventory_view.prtnum
                   and prt1.prt_client_id = all_inventory_view.prt_client_id
                   and prt1.wh_id_tmpl = all_inventory_view.wh_id
                  join TRXWMSPRD.dscmst
                    on colnam = /*#nobind*/ 'ordtyp|wh_id' /*#bind*/
                   and colval = /*=varchar(*/ nvl(ord.ordtyp, rtrim(' ')) || '|' || nvl(ord.wh_id, rtrim(' ')) /*=)*/ /*#bind*/
                   and dscmst.locale_id = 'ES-ES'
                  join TRXWMSPRD.ord_line
                    on ord_line.client_id = ord.client_id
                   and ord_line.ordnum = ord.ordnum
                   and ord_line.wh_id = ord.wh_id
                   and ord_line.client_id = shipment_line1.client_id
                   and ord_line.ordnum = shipment_line1.ordnum
                   and ord_line.ordlin = shipment_line1.ordlin
                   and ord_line.ordsln = shipment_line1.ordsln
                   and ord_line.wh_id = shipment_line1.wh_id
                   and ord_line.prt_client_id = shipment_line1.prt_client_id
                   and ord_line.prtnum = shipment_line1.prtnum
                  join TRXWMSPRD.prtfam
                    on prtfam.prtfam = prt1.prtfam
                  join TRXWMSPRD.prtfam_grp
                    on prtfam_grp.prtfamgrp = prtfam.prtfamgrp
                  join TRXWMSPRD.dscmst prtfamgrp_dsc
                    on prtfamgrp_dsc.colnam = /*#nobind*/ 'prtfamgrp' /*#bind*/
                   and prtfamgrp_dsc.colval = prtfam_grp.prtfamgrp
                   and prtfamgrp_dsc.locale_id = 'ES-ES'
                  join TRXWMSPRD.locmst
                    on locmst.stoloc = all_inventory_view.stoloc
                   and locmst.mov_zone_id = '10038'
                 where ord.wh_id = :wh_id
                   and car_move2.car_move_id = (select distinct cr.car_move_id
                                                  from TRXWMSPRD.all_inventory_view aiv
                                                  join TRXWMSPRD.shipment_line sl
                                                    on aiv.ship_line_id = sl.ship_line_id
                                                  join TRXWMSPRD.shipment sh
                                                    on sh.ship_id = sl.ship_id
                                                  join TRXWMSPRD.stop st
                                                    on st.stop_id = sh.stop_id
                                                  join TRXWMSPRD.car_move cr
                                                    on cr.car_move_id = st.car_move_id
                                                 where lodnum = :lodnum)
                   and all_inventory_view.phyflg = 0
              group by all_inventory_view.subnum,
                       prtfam.prtfamgrp) sumas) cajas_consolidadas,
					   
       (select nvl(sum(sumas.suma),0) /*obtener cajas no listas en sitio*/
          from (select ceil((select sum(lod1.untqty / lod1.untcas)
                               from TRXWMSPRD.all_inventory_view lod1
                              where lod1.subnum = all_inventory_view.subnum)) as suma,
                       prtfam.prtfamgrp
                  from TRXWMSPRD.ord
                  join TRXWMSPRD.shipment_line shipment_line1
                    on shipment_line1.ordnum = ord.ordnum
                   and shipment_line1.client_id = ord.client_id
                   and shipment_line1.wh_id = ord.wh_id
                  join TRXWMSPRD.shipment
                    on shipment.ship_id = shipment_line1.ship_id
                   and shipment.wh_id = shipment_line1.wh_id
                  join TRXWMSPRD.all_inventory_view
                    on all_inventory_view.ship_line_id = shipment_line1.ship_line_id
                   and all_inventory_view.wh_id = shipment_line1.wh_id
                   and all_inventory_view.prtnum = shipment_line1.prtnum
                   and all_inventory_view.prt_client_id = shipment_line1.prt_client_id
                  join TRXWMSPRD.stop stop_2
                    on stop_2.stop_id = shipment.stop_id
                  join TRXWMSPRD.car_move car_move2
                    on car_move2.car_move_id = stop_2.car_move_id
                  left
                  join TRXWMSPRD.trlr
                    on trlr.trlr_id = car_move2.trlr_id
                  join TRXWMSPRD.cstmst
                    on cstmst.cstnum = ord.stcust
                  join TRXWMSPRD.adrmst
                    on adrmst.adr_id = cstmst.adr_id
                  join TRXWMSPRD.prtmst prt1
                    on prt1.prtnum = all_inventory_view.prtnum
                   and prt1.prt_client_id = all_inventory_view.prt_client_id
                   and prt1.wh_id_tmpl = all_inventory_view.wh_id
                  join TRXWMSPRD.dscmst
                    on colnam = /*#nobind*/ 'ordtyp|wh_id' /*#bind*/
                   and colval = /*=varchar(*/ nvl(ord.ordtyp, rtrim(' ')) || '|' || nvl(ord.wh_id, rtrim(' ')) /*=)*/ /*#bind*/
                   and dscmst.locale_id = 'ES-ES'
                  join TRXWMSPRD.ord_line
                    on ord_line.client_id = ord.client_id
                   and ord_line.ordnum = ord.ordnum
                   and ord_line.wh_id = ord.wh_id
                   and ord_line.client_id = shipment_line1.client_id
                   and ord_line.ordnum = shipment_line1.ordnum
                   and ord_line.ordlin = shipment_line1.ordlin
                   and ord_line.ordsln = shipment_line1.ordsln
                   and ord_line.wh_id = shipment_line1.wh_id
                   and ord_line.prt_client_id = shipment_line1.prt_client_id
                   and ord_line.prtnum = shipment_line1.prtnum
                  join TRXWMSPRD.prtfam
                    on prtfam.prtfam = prt1.prtfam
                  join TRXWMSPRD.prtfam_grp
                    on prtfam_grp.prtfamgrp = prtfam.prtfamgrp
                  join TRXWMSPRD.dscmst prtfamgrp_dsc
                    on prtfamgrp_dsc.colnam = /*#nobind*/ 'prtfamgrp' /*#bind*/
                   and prtfamgrp_dsc.colval = prtfam_grp.prtfamgrp
                   and prtfamgrp_dsc.locale_id = 'ES-ES'
                  join TRXWMSPRD.locmst
                    on locmst.stoloc = all_inventory_view.stoloc
                   and locmst.mov_zone_id <> '10038'
                   and locmst.stoloc not like 'TRL%'
                 where ord.wh_id = :wh_id
                   and car_move2.car_move_id = (select distinct cr.car_move_id
                                                  from TRXWMSPRD.all_inventory_view aiv
                                                  join TRXWMSPRD.shipment_line sl
                                                    on aiv.ship_line_id = sl.ship_line_id
                                                  join TRXWMSPRD.shipment sh
                                                    on sh.ship_id = sl.ship_id
                                                  join TRXWMSPRD.stop st
                                                    on st.stop_id = sh.stop_id
                                                  join TRXWMSPRD.car_move cr
                                                    on cr.car_move_id = st.car_move_id
                                                 where lodnum = :lodnum)
                and all_inventory_view.phyflg = 0
              group by all_inventory_view.subnum,
                    prtfam.prtfamgrp) sumas) cajas_no_consolidadas,
					
					
       (select count(distinct all_inventory_view.subnum) /*obtener cajas fisicas cargadas en trailer*/
          from TRXWMSPRD.car_move
          join TRXWMSPRD.stop
            on stop.car_move_id = car_move.car_move_id
          join TRXWMSPRD.shipment
            on shipment.stop_id = stop.stop_id
          join TRXWMSPRD.shipment_line
            on shipment_line.ship_id = shipment.ship_id
          left
          join TRXWMSPRD.all_inventory_view
            on all_inventory_view.ship_line_id = shipment_line.ship_line_id
           and all_inventory_view.wh_id = shipment_line.wh_id
           and all_inventory_view.wh_id = shipment.wh_id
          join TRXWMSPRD.prtmst
            on all_inventory_view.prtnum = prtmst.prtnum
           and all_inventory_view.prt_client_id = prtmst.prt_client_id
           and all_inventory_view.wh_id = prtmst.wh_id_tmpl
          join TRXWMSPRD.prtfam
            on prtfam.prtfam = prtmst.prtfam
          join TRXWMSPRD.prtfam_grp
            on prtfam_grp.prtfamgrp = prtfam.prtfamgrp
          left
          join TRXWMSPRD.prtdsc
            on prtdsc.colnam = /*#nobind*/ 'prtnum|prt_client_id|wh_id_tmpl' /*#bind*/
           and prtdsc.colval = prtmst.prtnum || '|' || prtmst.prt_client_id || '|' || prtmst.wh_id_tmpl
           and prtdsc.locale_id = /*#nobind*/ 'ES-ES' /*#bind*/
          join TRXWMSPRD.dscmst prtfamgrp_dsc
            on prtfamgrp_dsc.colnam = /*#nobind*/ 'prtfamgrp' /*#bind*/
           and prtfamgrp_dsc.colval = prtfam_grp.prtfamgrp
           and prtfamgrp_dsc.locale_id = 'ES-ES'
          join TRXWMSPRD.locmst
            on locmst.stoloc = all_inventory_view.stoloc
           and locmst.stoloc like 'TRL%'
         where all_inventory_view.wh_id = :wh_id
           and car_move.car_move_id = (select distinct cr.car_move_id
                                         from TRXWMSPRD.all_inventory_view aiv
                                         join TRXWMSPRD.shipment_line sl
                                           on aiv.ship_line_id = sl.ship_line_id
                                         join TRXWMSPRD.shipment sh
                                           on sh.ship_id = sl.ship_id
                                         join TRXWMSPRD.stop st
                                           on st.stop_id = sh.stop_id
                                         join TRXWMSPRD.car_move cr
                                           on cr.car_move_id = st.car_move_id
                                        where lodnum = :lodnum)
           and (all_inventory_view.phyflg = 1)) +
		   
       (select nvl(sum(sumas.suma),0) /*obtener cajas no fisicas cargadas en trailer*/
          from (select ceil((select sum(lod1.untqty / lod1.untcas)
                               from TRXWMSPRD.all_inventory_view lod1
                              where lod1.subnum = all_inventory_view.subnum)) as suma,
                       prtfam.prtfamgrp
                  from TRXWMSPRD.ord
                  join TRXWMSPRD.shipment_line shipment_line1
                    on shipment_line1.ordnum = ord.ordnum
                   and shipment_line1.client_id = ord.client_id
                   and shipment_line1.wh_id = ord.wh_id
                  join TRXWMSPRD.shipment
                    on shipment.ship_id = shipment_line1.ship_id
                   and shipment.wh_id = shipment_line1.wh_id
                  join TRXWMSPRD.all_inventory_view
                    on all_inventory_view.ship_line_id = shipment_line1.ship_line_id
                   and all_inventory_view.wh_id = shipment_line1.wh_id
                   and all_inventory_view.prtnum = shipment_line1.prtnum
                   and all_inventory_view.prt_client_id = shipment_line1.prt_client_id
                  join TRXWMSPRD.stop stop_2
                    on stop_2.stop_id = shipment.stop_id
                  join TRXWMSPRD.car_move car_move2
                    on car_move2.car_move_id = stop_2.car_move_id
                  left
                  join TRXWMSPRD.trlr
                    on trlr.trlr_id = car_move2.trlr_id
                  join TRXWMSPRD.cstmst
                    on cstmst.cstnum = ord.stcust
                  join TRXWMSPRD.adrmst
                    on adrmst.adr_id = cstmst.adr_id
                  join TRXWMSPRD.prtmst prt1
                    on prt1.prtnum = all_inventory_view.prtnum
                   and prt1.prt_client_id = all_inventory_view.prt_client_id
                   and prt1.wh_id_tmpl = all_inventory_view.wh_id
                  join TRXWMSPRD.dscmst
                    on colnam = /*#nobind*/ 'ordtyp|wh_id' /*#bind*/
                   and colval = /*=varchar(*/ nvl(ord.ordtyp, rtrim(' ')) || '|' || nvl(ord.wh_id, rtrim(' ')) /*=)*/ /*#bind*/
                   and dscmst.locale_id = 'ES-ES'
                  join TRXWMSPRD.ord_line
                    on ord_line.client_id = ord.client_id
                   and ord_line.ordnum = ord.ordnum
                   and ord_line.wh_id = ord.wh_id
                   and ord_line.client_id = shipment_line1.client_id
                   and ord_line.ordnum = shipment_line1.ordnum
                   and ord_line.ordlin = shipment_line1.ordlin
                   and ord_line.ordsln = shipment_line1.ordsln
                   and ord_line.wh_id = shipment_line1.wh_id
                   and ord_line.prt_client_id = shipment_line1.prt_client_id
                   and ord_line.prtnum = shipment_line1.prtnum
                  join TRXWMSPRD.prtfam
                    on prtfam.prtfam = prt1.prtfam
                  join TRXWMSPRD.prtfam_grp
                    on prtfam_grp.prtfamgrp = prtfam.prtfamgrp
                  join TRXWMSPRD.dscmst prtfamgrp_dsc
                    on prtfamgrp_dsc.colnam = /*#nobind*/ 'prtfamgrp' /*#bind*/
                   and prtfamgrp_dsc.colval = prtfam_grp.prtfamgrp
                   and prtfamgrp_dsc.locale_id = 'ES-ES'
                  join TRXWMSPRD.locmst
                    on locmst.stoloc = all_inventory_view.stoloc
                   and locmst.stoloc like 'TRL%'
                 where ord.wh_id = :wh_id
                   and car_move2.car_move_id = (select distinct cr.car_move_id
                                                  from TRXWMSPRD.all_inventory_view aiv
                                                  join TRXWMSPRD.shipment_line sl
                                                    on aiv.ship_line_id = sl.ship_line_id
                                                  join TRXWMSPRD.shipment sh
                                                    on sh.ship_id = sl.ship_id
                                                  join TRXWMSPRD.stop st
                                                    on st.stop_id = sh.stop_id
                                                  join TRXWMSPRD.car_move cr
                                                    on cr.car_move_id = st.car_move_id
                                                 where lodnum = :lodnum)
                   and all_inventory_view.phyflg = 0
              group by all_inventory_view.subnum,
                       prtfam.prtfamgrp) sumas) cajas_cargadas,
                       
       (select count(distinct all_inventory_view.subnum)
                /*obtener cajas fisicas en LPN*/
           from TRXWMSPRD.car_move
           join TRXWMSPRD.stop
             on stop.car_move_id = car_move.car_move_id
           join TRXWMSPRD.shipment
             on shipment.stop_id = stop.stop_id
           join TRXWMSPRD.shipment_line
             on shipment_line.ship_id = shipment.ship_id
           left
           join TRXWMSPRD.all_inventory_view
             on all_inventory_view.ship_line_id = shipment_line.ship_line_id
            and all_inventory_view.wh_id = shipment_line.wh_id
            and all_inventory_view.wh_id = shipment.wh_id
           join TRXWMSPRD.prtmst
             on all_inventory_view.prtnum = prtmst.prtnum
            and all_inventory_view.prt_client_id = prtmst.prt_client_id
            and all_inventory_view.wh_id = prtmst.wh_id_tmpl
           join TRXWMSPRD.prtfam
             on prtfam.prtfam = prtmst.prtfam
           join TRXWMSPRD.prtfam_grp
             on prtfam_grp.prtfamgrp = prtfam.prtfamgrp
           left
           join TRXWMSPRD.prtdsc
             on prtdsc.colnam = /*#nobind*/ 'prtnum|prt_client_id|wh_id_tmpl' /*#bind*/
            and prtdsc.colval = prtmst.prtnum || '|' || prtmst.prt_client_id || '|' || prtmst.wh_id_tmpl
            and prtdsc.locale_id = /*#nobind*/ 'ES-ES' /*#bind*/
           join TRXWMSPRD.dscmst prtfamgrp_dsc
             on prtfamgrp_dsc.colnam = /*#nobind*/ 'prtfamgrp' /*#bind*/
            and prtfamgrp_dsc.colval = prtfam_grp.prtfamgrp
            and prtfamgrp_dsc.locale_id = 'ES-ES'
           join TRXWMSPRD.locmst
             on locmst.stoloc = all_inventory_view.stoloc
          where all_inventory_view.wh_id = :wh_id
            and all_inventory_view.lodnum = :lodnum
            and (all_inventory_view.phyflg = 1)) + (select nvl(sum(sumas.suma), 0)
                                                           /*obtener cajas no fisicas cargadas en LPN*/
                                                      from (select ceil((select sum(lod1.untqty / lod1.untcas)
                                                                           from TRXWMSPRD.all_inventory_view lod1
                                                                          where lod1.subnum = all_inventory_view.subnum)) as suma,
                                                                   prtfam.prtfamgrp
                                                              from TRXWMSPRD.ord
                                                              join TRXWMSPRD.shipment_line shipment_line1
                                                                on shipment_line1.ordnum = ord.ordnum
                                                               and shipment_line1.client_id = ord.client_id
                                                               and shipment_line1.wh_id = ord.wh_id
                                                              join TRXWMSPRD.shipment
                                                                on shipment.ship_id = shipment_line1.ship_id
                                                               and shipment.wh_id = shipment_line1.wh_id
                                                              join TRXWMSPRD.all_inventory_view
                                                                on all_inventory_view.ship_line_id = shipment_line1.ship_line_id
                                                               and all_inventory_view.wh_id = shipment_line1.wh_id
                                                               and all_inventory_view.prtnum = shipment_line1.prtnum
                                                               and all_inventory_view.prt_client_id = shipment_line1.prt_client_id
                                                              join TRXWMSPRD.stop stop_2
                                                                on stop_2.stop_id = shipment.stop_id
                                                              join TRXWMSPRD.car_move car_move2
                                                                on car_move2.car_move_id = stop_2.car_move_id
                                                              left
                                                              join TRXWMSPRD.trlr
                                                                on trlr.trlr_id = car_move2.trlr_id
                                                              join TRXWMSPRD.cstmst
                                                                on cstmst.cstnum = ord.stcust
                                                              join TRXWMSPRD.adrmst
                                                                on adrmst.adr_id = cstmst.adr_id
                                                              join TRXWMSPRD.prtmst prt1
                                                                on prt1.prtnum = all_inventory_view.prtnum
                                                               and prt1.prt_client_id = all_inventory_view.prt_client_id
                                                               and prt1.wh_id_tmpl = all_inventory_view.wh_id
                                                              join TRXWMSPRD.dscmst
                                                                on colnam = /*#nobind*/ 'ordtyp|wh_id' /*#bind*/
                                                               and colval = /*=varchar(*/ nvl(ord.ordtyp, rtrim(' ')) || '|' || nvl(ord.wh_id, rtrim(' ')) /*=)*/ /*#bind*/
                                                               and dscmst.locale_id = 'ES-ES'
                                                              join TRXWMSPRD.ord_line
                                                                on ord_line.client_id = ord.client_id
                                                               and ord_line.ordnum = ord.ordnum
                                                               and ord_line.wh_id = ord.wh_id
                                                               and ord_line.client_id = shipment_line1.client_id
                                                              and ord_line.ordnum = shipment_line1.ordnum
                                                               and ord_line.ordlin = shipment_line1.ordlin
                                                               and ord_line.ordsln = shipment_line1.ordsln
                                                               and ord_line.wh_id = shipment_line1.wh_id
                                                               and ord_line.prt_client_id = shipment_line1.prt_client_id
                                                               and ord_line.prtnum = shipment_line1.prtnum
                                                              join TRXWMSPRD.prtfam
                                                                on prtfam.prtfam = prt1.prtfam
                                                              join TRXWMSPRD.prtfam_grp
                                                                on prtfam_grp.prtfamgrp = prtfam.prtfamgrp
                                                              join TRXWMSPRD.dscmst prtfamgrp_dsc
                                                                on prtfamgrp_dsc.colnam = /*#nobind*/ 'prtfamgrp' /*#bind*/
                                                               and prtfamgrp_dsc.colval = prtfam_grp.prtfamgrp
                                                               and prtfamgrp_dsc.locale_id = 'ES-ES'
                                                              join TRXWMSPRD.locmst
                                                                on locmst.stoloc = all_inventory_view.stoloc
                                                             where all_inventory_view.wh_id = 'AVIOR-27'
                                                               and all_inventory_view.lodnum = :lodnum
                                                               and all_inventory_view.phyflg = 0
                                                             group by all_inventory_view.subnum,
                                                                   prtfam.prtfamgrp) sumas) cajas_en_LPN,
                                                                   
       (select distinct nvl(max('1'),0)
          from TRXWMSPRD.all_inventory_view aiv
          join TRXWMSPRD.pckwrk_view pwv
            on aiv.wrkref = pwv.wrkref
          join TRXWMSPRD.ord
            on pwv.ordnum = ord.ordnum
         where aiv.lodnum = :lodnum
           and ord.ordtyp = 'S-URGE') urgente,
                                
       (select distinct nvl(max('1'),0) 
          from TRXWMSPRD.all_inventory_view aiv
          join TRXWMSPRD.pckwrk_view pwv
            on aiv.wrkref = pwv.wrkref
          join TRXWMSPRD.ord
            on pwv.ordnum = ord.ordnum
         where aiv.lodnum = :lodnum
           and ord.ordtyp = 'S-SPUR') sop_vida,
                             
       (select distinct nvl(max('1'),0) 
          from TRXWMSPRD.all_inventory_view aiv
          join TRXWMSPRD.prtmst pm
            on aiv.prtnum = pm.prtnum
           and aiv.wh_id = pm.wh_id_tmpl
         where pm.prtfam = '401'
           and lodnum = :lodnum) controlado

from dual]]></db:sql>
			<db:input-parameters ><![CDATA[#[payload]]]></db:input-parameters>
		</db:select>
	</sub-flow>
	<sub-flow name="client-db-wms-get-download-sequence" doc:id="15cef186-5c0b-4b19-bd30-fd34144e7faa" >
		<db:select doc:name="Select" doc:id="b72ccc08-b40d-464d-a750-8a93706f1e62" config-ref="Database_Config_WMS_BlueYonder" >
			<db:sql ><![CDATA[select distinct TRXWMSPRD.sl_dwnld.*
   from TRXWMSPRD.sl_ifd_data_dtl
   join TRXWMSPRD.sl_ifd_data_hdr
     on TRXWMSPRD.sl_ifd_data_hdr.ifd_data_seq = sl_ifd_data_dtl.ifd_data_seq
   join TRXWMSPRD.sl_dwnld
     on TRXWMSPRD.sl_dwnld.dwnld_seq = sl_ifd_data_hdr.dwnld_seq
  where TRXWMSPRD.sl_dwnld.DWNLD_SEQ like :downloadSequence]]></db:sql>
			<db:input-parameters ><![CDATA[#[downloadSequence: "%" ++ payload ++ "%"]]]></db:input-parameters>
		</db:select>
	</sub-flow>
	<sub-flow name="client-db-wms-daily-balance-sp" doc:id="65b13491-4f77-497b-8efe-62dd55b9ff04" >
		<db:stored-procedure doc:name="Stored procedure" doc:id="908312f3-8c40-4271-9e46-d4e16dd6b4cd" config-ref="Database_Config_WMS_BlueYonder">
			<db:sql ><![CDATA[{ call DAILY_INVENTORY_UPDATE }]]></db:sql>
		</db:stored-procedure>
	</sub-flow>
	<sub-flow name="client-db-wms-get-lines" doc:id="2f725d7f-c922-4298-b06b-6c487491fd9c" >
				<db:select doc:name="Select" doc:id="a0bcabc4-7acf-4670-aa81-836a69902a3e" config-ref="Database_Config_WMS_BlueYonder">
			<db:sql ><![CDATA[select shipment.host_ext_id host_ship_id,
                shipment.host_client_id host_client_id,
                shipment_line.ship_id ship_id,
                shipment_line.ordnum ordnum,
                shipment_line.ordlin ordlin,
                shipment_line.ordsln ordsln,
                ord_line.prtnum prtnum,
                pckwrk_view.lotnum,
                pckwrk_view.orgcod,
                pckwrk_view.revlvl,
                pckwrk_view.mandte,
                pckwrk_view.expire_dte,
                ord_line.invsts_prg invsts_prg,
                ord_line.client_id,
                '+' comsgn,
                sum(pckwrk_view.pckqty) comqty,
                ord.wh_id,
                pckwrk_view.inv_attr_str1,
                pckwrk_view.inv_attr_str2,
                pckwrk_view.inv_attr_str3,
                pckwrk_view.inv_attr_str4,
                pckwrk_view.inv_attr_str5,
                pckwrk_view.inv_attr_str6,
                pckwrk_view.inv_attr_str7,
                pckwrk_view.inv_attr_str8,
                pckwrk_view.inv_attr_str9,
                pckwrk_view.inv_attr_str10,
                pckwrk_view.inv_attr_str11,
                pckwrk_view.inv_attr_str12,
                pckwrk_view.inv_attr_str13,
                pckwrk_view.inv_attr_str14,
                pckwrk_view.inv_attr_str15,
                pckwrk_view.inv_attr_str16,
                pckwrk_view.inv_attr_str17,
                pckwrk_view.inv_attr_str18,
                pckwrk_view.inv_attr_int1,
                pckwrk_view.inv_attr_int2,
                pckwrk_view.inv_attr_int3,
                pckwrk_view.inv_attr_int4,
                pckwrk_view.inv_attr_int5,
                pckwrk_view.inv_attr_flt1,
                pckwrk_view.inv_attr_flt2,
                pckwrk_view.inv_attr_flt3,
                pckwrk_view.inv_attr_dte1,
                pckwrk_view.inv_attr_dte2,
                (select value
                   from alloc_rule_dtl ruldtl
                  where ruldtl.field_name = 'rttn_id'
                    and rulhdr.cplx_flg = 0
                    and ruldtl.rule_nam = rulhdr.rule_nam
                    and ruldtl.wh_id = ord.wh_id
                    and ruldtl.rule_nam = ord_line.rule_nam) rttn_id,
                (select value
                   from alloc_rule_dtl ruldtl
                  where ruldtl.field_name = 'cstms_bond_flg'
                    and rulhdr.cplx_flg = 0
                    and ruldtl.rule_nam = rulhdr.rule_nam
                    and ruldtl.wh_id = ord.wh_id
                    and ruldtl.rule_nam = ord_line.rule_nam) cstms_bond_flg,
                (select value
                   from alloc_rule_dtl ruldtl
                  where ruldtl.field_name = 'dty_stmp_flg'
                    and rulhdr.cplx_flg = 0
                    and ruldtl.rule_nam = rulhdr.rule_nam
                    and ruldtl.wh_id = ord.wh_id
                    and ruldtl.rule_nam = ord_line.rule_nam) dty_stmp_flg,
                ord_line.asset_typ,
                ord_line.load_attr1_cfg,
                ord_line.load_attr2_cfg,
                ord_line.load_attr3_cfg,
                ord_line.load_attr4_cfg,
                ord_line.load_attr5_cfg
           from shipment,
                pckwrk_view,
                ord,
                shipment_line,
                ord_line
           left outer
           join alloc_rule_hdr rulhdr
             on rulhdr.rule_nam = ord_line.rule_nam
            and rulhdr.wh_id = ord_line.wh_id
          where shipment.ship_id = shipment_line.ship_id
            and pckwrk_view.ship_line_id = shipment_line.ship_line_id
            and ord.ordnum = ord_line.ordnum
            and ord.client_id = ord_line.client_id
            and ord.wh_id = ord_line.wh_id
            and ord_line.client_id = shipment_line.client_id
            and ord_line.ordnum = shipment_line.ordnum
            and ord_line.ordlin = shipment_line.ordlin
            and ord_line.ordsln = shipment_line.ordsln
            and ord_line.wh_id = shipment_line.wh_id
            and ord.ordnum = :orderNumber
          group by shipment.host_ext_id,
                shipment.host_client_id,
                shipment_line.ship_id,
                shipment_line.ordnum,
                shipment_line.ordlin,
                shipment_line.ordsln,
                ord_line.prtnum,
                pckwrk_view.lotnum,
                pckwrk_view.orgcod,
                pckwrk_view.revlvl,
                pckwrk_view.mandte,
                pckwrk_view.expire_dte,
                ord_line.invsts_prg,
                ord_line.client_id,
                ord.wh_id,
                pckwrk_view.inv_attr_str1,
                pckwrk_view.inv_attr_str2,
                pckwrk_view.inv_attr_str3,
                pckwrk_view.inv_attr_str4,
                pckwrk_view.inv_attr_str5,
                pckwrk_view.inv_attr_str6,
                pckwrk_view.inv_attr_str7,
                pckwrk_view.inv_attr_str8,
                pckwrk_view.inv_attr_str9,
                pckwrk_view.inv_attr_str10,
                pckwrk_view.inv_attr_str11,
                pckwrk_view.inv_attr_str12,
                pckwrk_view.inv_attr_str13,
                pckwrk_view.inv_attr_str14,
                pckwrk_view.inv_attr_str15,
                pckwrk_view.inv_attr_str16,
                pckwrk_view.inv_attr_str17,
                pckwrk_view.inv_attr_str18,
                pckwrk_view.inv_attr_int1,
                pckwrk_view.inv_attr_int2,
                pckwrk_view.inv_attr_int3,
                pckwrk_view.inv_attr_int4,
                pckwrk_view.inv_attr_int5,
                pckwrk_view.inv_attr_flt1,
                pckwrk_view.inv_attr_flt2,
                pckwrk_view.inv_attr_flt3,
                pckwrk_view.inv_attr_dte1,
                pckwrk_view.inv_attr_dte2,
                rulhdr.cplx_flg,
                ord_line.rule_nam,
                rulhdr.rule_nam,
                ord_line.asset_typ,
                ord_line.load_attr1_cfg,
                ord_line.load_attr2_cfg,
                ord_line.load_attr3_cfg,
                ord_line.load_attr4_cfg,
                ord_line.load_attr5_cfg]]></db:sql>
			<db:input-parameters ><![CDATA[#[{
	orderNumber: attributes.queryParams.order_number
}]]]></db:input-parameters>
		</db:select>
	</sub-flow>
</mule>
