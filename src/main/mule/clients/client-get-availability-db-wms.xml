<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
	<db:config name="Database_Config" doc:name="Database Config" doc:id="8027ec1c-c384-40b7-b03e-bc7a41f3a515" >
		<db:oracle-connection host="150.136.181.19" user="system" password="QAzwsx_741#" serviceName="traxiontstpdb.sub03050614210.vcnwms.oraclevcn.com"/>
	</db:config>
	<sub-flow name="client-get-availability-db-wms-get-availability" doc:id="8cf9afc6-58b3-49d5-9ae7-8f8d694bb829" >
		<db:select doc:name="Select" doc:id="efda0571-bb4f-4dc0-becb-413ac6981664" config-ref="Database_Config">
			<db:sql ><![CDATA[select ol.prtnum,
	ol.prt_client_id,
	ol.wh_id,
	sum(ol.ordqty) ordqty,
	sum(ol.rsvqty) rsvqty,
	sum(ol.pckqty) pckqty,
	sum(ol.shpqty) shpqty,
	sum(sl.stgqty) stgqty,
	sum(sl.inpqty) inpqty,
	sum(sl.oviqty) oviqty 
from TRAXWMSTST.ord ord 
join TRAXWMSTST.ord_line ol
	 on ord.client_id = ol.client_id
	 and ord.ordnum = ol.ordnum
	 and ord.wh_id = ol.wh_id
LEFT join TRAXWMSTST.shipment_line sl
	on ol.ordnum = sl.ordnum
	and ol.ordlin = sl.ordlin
	and ol.ordsln = sl.ordsln
	and ol.wh_id = sl.wh_id
	and ol.client_id = sl.client_id
	and sl.linsts != 'B'
LEFT join TRAXWMSTST.shipment s
	 on sl.ship_id = s.ship_id
	 and s.super_ship_flg = 0
	 and s.super_ship_id is null
	 and s.shpsts != 'B'
   where ord.client_id = ol.prt_client_id
	 and ord.wh_id = 'AVIOR-27'
	 and ord.super_ord_flg = 0
	 and ol.shpqty < ol.ordqty
	 and ol.non_alc_flg = '0'
	 and ol.invsts_prg = 'DISP'
	 and ol.cancelled_flg <> 1
   group by ol.prtnum,ol.prt_client_id,ol.wh_id]]></db:sql>
		</db:select>
	</sub-flow>
</mule>
